{"version":3,"file":"preview.min.js","sources":["../src/preview.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Javascript for preview.\r\n *\r\n * @module     qbank_preview/preview\r\n * @copyright  2021 Catalyst IT Australia Pty Ltd\r\n * @author     Safat Shahin <safatshahin@catalyst-au.net>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport $ from 'jquery';\r\n\r\n/**\r\n * Set up the actions.\r\n *\r\n * @method init\r\n * @param {bool} redirect Redirect.\r\n * @param {string} url url to redirect.\r\n */\r\nexport const init = (redirect, url) => {\r\n    if (!redirect) {\r\n        let closeButton = document.getElementById('close-previewquestion-page');\r\n        closeButton.onclick = () => {\r\n            if (window.opener === null) {\r\n                location.href = url;\r\n            } else {\r\n                window.close();\r\n            }\r\n        };\r\n    }\r\n    // Set up the form to be displayed.\r\n    setupQuestionForm('responseform');\r\n};\r\n\r\n/**\r\n * Set up the form element to be displayed.\r\n *\r\n * @method setupQuestionForm\r\n * @param {string} formElement The form element.\r\n */\r\nconst setupQuestionForm = (formElement) => {\r\n    let form = document.getElementById(formElement);\r\n    if (form) {\r\n        // Turning off browser autocomplete.\r\n        autocompleteOff(form);\r\n        // Stop a question form being submitted more than once.\r\n        preventRepeatSubmission(form);\r\n        // Removes any '.questionflagsavebutton's, since we have JavaScript to toggle.\r\n        removeClass('.questionflagsavebutton', form);\r\n        // Scroll to the position indicated by scrollpos= in the URL, if it is there.\r\n        scrollToSavedPos(form);\r\n    }\r\n};\r\n\r\n/**\r\n * Set the autocomplete off.\r\n *\r\n * @method autocompleteOff\r\n * @param {object} form The form element.\r\n */\r\nconst autocompleteOff = (form) => {\r\n    form.setAttribute(\"autocomplete\", \"off\");\r\n};\r\n\r\n/**\r\n * Event handler to stop a question form being submitted more than once.\r\n *\r\n * @method preventRepeatSubmission\r\n * @param {object} form The form element.\r\n */\r\nconst preventRepeatSubmission = (form) => {\r\n    form.addEventListener(\"submit\", function() {\r\n        $(this).submit(function() {\r\n            return false;\r\n        });\r\n        return true;\r\n    });\r\n};\r\n\r\n/**\r\n *  Removes a class inside an element.\r\n *\r\n * @method removeClass\r\n * @param {string} classname Class name.\r\n * @param {object} form The form element.\r\n */\r\nconst removeClass = (classname, form) => {\r\n    form.querySelectorAll(classname).forEach(e => e.remove());\r\n};\r\n\r\n/**\r\n *  If there is a parameter like scrollpos=123 in the URL, scroll to that saved position.\r\n *  (Note: Moodle 4.0 and above do NOT support Internet Explorer 11 and below.)\r\n *\r\n * @method scrollToSavedPos\r\n * @param {object} form The form element.\r\n */\r\nconst scrollToSavedPos = (form) => {\r\n    let matches = window.location.href.match(/^.*[?&]scrollpos=(\\d*)(?:&|$|#).*$/, '$1');\r\n    if (matches) {\r\n        // DOMContentLoaded is the effective one here. I am leaving the immediate call to\r\n        // window.scrollTo in case it reduces flicker.\r\n        window.scrollTo(0, matches[1]);\r\n        form.addEventListener(\"DOMContentLoaded\", () => {\r\n            window.scrollTo(0, matches[1]);\r\n        });\r\n    }\r\n};\r\n"],"names":["redirect","url","document","getElementById","onclick","window","opener","location","href","close","setupQuestionForm","formElement","form","autocompleteOff","preventRepeatSubmission","removeClass","scrollToSavedPos","setAttribute","addEventListener","this","submit","classname","querySelectorAll","forEach","e","remove","matches","match","scrollTo"],"mappings":";;;;;;;;wJAiCoB,CAACA,SAAUC,WACtBD,SAAU,CACOE,SAASC,eAAe,8BAC9BC,QAAU,KACI,OAAlBC,OAAOC,OACPC,SAASC,KAAOP,IAEhBI,OAAOI,SAKnBC,kBAAkB,uBAShBA,kBAAqBC,kBACnBC,KAAOV,SAASC,eAAeQ,aAC/BC,OAEAC,gBAAgBD,MAEhBE,wBAAwBF,MAExBG,YAAY,0BAA2BH,MAEvCI,iBAAiBJ,QAUnBC,gBAAmBD,OACrBA,KAAKK,aAAa,eAAgB,QAShCH,wBAA2BF,OAC7BA,KAAKM,iBAAiB,UAAU,qCAC1BC,MAAMC,QAAO,kBACJ,MAEJ,MAWTL,YAAc,CAACM,UAAWT,QAC5BA,KAAKU,iBAAiBD,WAAWE,SAAQC,GAAKA,EAAEC,YAU9CT,iBAAoBJ,WAClBc,QAAUrB,OAAOE,SAASC,KAAKmB,MAAM,qCAAsC,MAC3ED,UAGArB,OAAOuB,SAAS,EAAGF,QAAQ,IAC3Bd,KAAKM,iBAAiB,oBAAoB,KACtCb,OAAOuB,SAAS,EAAGF,QAAQ"}