{"version":3,"file":"collapsesections.min.js","sources":["../src/collapsesections.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Collapse or expand all form sections on clicking the expand all / collapse al link.\r\n *\r\n * @module core_form/collapsesections\r\n * @copyright 2021 Bas Brands\r\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n * @since 4.0\r\n */\r\n\r\nimport $ from 'jquery';\r\nimport Pending from 'core/pending';\r\n\r\nconst SELECTORS = {\r\n    FORMHEADER: '.fheader',\r\n    FORMCONTAINER: '.fcontainer',\r\n};\r\n\r\nconst CLASSES = {\r\n    SHOW: 'show',\r\n    COLLAPSED: 'collapsed'\r\n};\r\n\r\n/**\r\n * Initialises the form section collapse / expand action.\r\n *\r\n * @param {string} collapsesections the collapse/expand link id.\r\n */\r\nexport const init = collapsesections => {\r\n    // All jQuery in this code can be replaced when MDL-71979 is integrated (move to Bootstrap 5).\r\n    const pendingPromise = new Pending('core_form/collapsesections');\r\n    const collapsemenu = document.querySelector(collapsesections);\r\n    const formParent = collapsemenu.closest('form');\r\n    collapsemenu.addEventListener('keydown', e => {\r\n        if (e.key === 'Enter' || e.key === ' ') {\r\n            e.preventDefault();\r\n            collapsemenu.click();\r\n        }\r\n    });\r\n\r\n    // Override default collapse class if all containers are expanded on page load\r\n    let expandedcount = 0;\r\n    const formcontainercount = $(SELECTORS.FORMCONTAINER).length;\r\n    $(SELECTORS.FORMCONTAINER).each((_, collapsecontainer) => {\r\n        if (collapsecontainer.classList.contains(CLASSES.SHOW)) {\r\n            expandedcount++;\r\n        }\r\n    });\r\n\r\n    if (formcontainercount === expandedcount) {\r\n        collapsemenu.classList.remove(CLASSES.COLLAPSED);\r\n        collapsemenu.setAttribute('aria-expanded', true);\r\n    }\r\n\r\n    collapsemenu.addEventListener('click', () => {\r\n        let action = 'hide';\r\n        if (collapsemenu.classList.contains(CLASSES.COLLAPSED)) {\r\n            action = 'show';\r\n        }\r\n\r\n        formParent.querySelectorAll(SELECTORS.FORMCONTAINER).forEach((collapsecontainer) => {\r\n            $(collapsecontainer).collapse(action);\r\n        });\r\n    });\r\n\r\n    // Ensure collapse menu button adds aria-controls attribute referring to each collapsible element.\r\n    const collapseElements = $(SELECTORS.FORMHEADER);\r\n    const collapseElementIds = [...collapseElements].map((element, index) => {\r\n        element.id = element.id || `collapseElement-${index}`;\r\n        return element.id;\r\n    });\r\n    collapsemenu.setAttribute('aria-controls', collapseElementIds.join(' '));\r\n\r\n    $(SELECTORS.FORMCONTAINER).on('hidden.bs.collapse', () => {\r\n        let allCollapsed = true;\r\n\r\n        formParent.querySelectorAll(SELECTORS.FORMCONTAINER).forEach((collapsecontainer) => {\r\n            if (collapsecontainer.classList.contains(CLASSES.SHOW)) {\r\n                allCollapsed = false;\r\n            }\r\n        });\r\n\r\n        if (allCollapsed) {\r\n            collapsemenu.classList.add(CLASSES.COLLAPSED);\r\n            collapsemenu.setAttribute('aria-expanded', false);\r\n        }\r\n    });\r\n    $(SELECTORS.FORMCONTAINER).on('shown.bs.collapse', () => {\r\n        let allExpanded = true;\r\n\r\n        formParent.querySelectorAll(SELECTORS.FORMCONTAINER).forEach((collapsecontainer) => {\r\n            if (!collapsecontainer.classList.contains(CLASSES.SHOW)) {\r\n                allExpanded = false;\r\n            }\r\n        });\r\n\r\n        if (allExpanded) {\r\n            collapsemenu.classList.remove(CLASSES.COLLAPSED);\r\n            collapsemenu.setAttribute('aria-expanded', true);\r\n        }\r\n    });\r\n    pendingPromise.resolve();\r\n};\r\n"],"names":["SELECTORS","CLASSES","collapsesections","pendingPromise","Pending","collapsemenu","document","querySelector","formParent","closest","addEventListener","e","key","preventDefault","click","expandedcount","formcontainercount","length","each","_","collapsecontainer","classList","contains","remove","setAttribute","action","querySelectorAll","forEach","collapse","collapseElementIds","map","element","index","id","join","on","allCollapsed","add","allExpanded","resolve"],"mappings":";;;;;;;;0KA2BMA,qBACU,WADVA,wBAEa,cAGbC,aACI,OADJA,kBAES,0BAQKC,yBAEVC,eAAiB,IAAIC,iBAAQ,8BAC7BC,aAAeC,SAASC,cAAcL,kBACtCM,WAAaH,aAAaI,QAAQ,QACxCJ,aAAaK,iBAAiB,WAAWC,IACvB,UAAVA,EAAEC,KAA6B,MAAVD,EAAEC,MACvBD,EAAEE,iBACFR,aAAaS,gBAKjBC,cAAgB,QACdC,oBAAqB,mBAAEhB,yBAAyBiB,2BACpDjB,yBAAyBkB,MAAK,CAACC,EAAGC,qBAC5BA,kBAAkBC,UAAUC,SAASrB,eACrCc,mBAIJC,qBAAuBD,gBACvBV,aAAagB,UAAUE,OAAOtB,mBAC9BI,aAAamB,aAAa,iBAAiB,IAG/CnB,aAAaK,iBAAiB,SAAS,SAC/Be,OAAS,OACTpB,aAAagB,UAAUC,SAASrB,qBAChCwB,OAAS,QAGbjB,WAAWkB,iBAAiB1B,yBAAyB2B,SAASP,wCACxDA,mBAAmBQ,SAASH,oBAMhCI,mBAAqB,KADF,mBAAE7B,uBACsB8B,KAAI,CAACC,QAASC,SAC3DD,QAAQE,GAAKF,QAAQE,8BAAyBD,OACvCD,QAAQE,MAEnB5B,aAAamB,aAAa,gBAAiBK,mBAAmBK,KAAK,0BAEjElC,yBAAyBmC,GAAG,sBAAsB,SAC5CC,cAAe,EAEnB5B,WAAWkB,iBAAiB1B,yBAAyB2B,SAASP,oBACtDA,kBAAkBC,UAAUC,SAASrB,gBACrCmC,cAAe,MAInBA,eACA/B,aAAagB,UAAUgB,IAAIpC,mBAC3BI,aAAamB,aAAa,iBAAiB,2BAGjDxB,yBAAyBmC,GAAG,qBAAqB,SAC3CG,aAAc,EAElB9B,WAAWkB,iBAAiB1B,yBAAyB2B,SAASP,oBACrDA,kBAAkBC,UAAUC,SAASrB,gBACtCqC,aAAc,MAIlBA,cACAjC,aAAagB,UAAUE,OAAOtB,mBAC9BI,aAAamB,aAAa,iBAAiB,OAGnDrB,eAAeoC"}